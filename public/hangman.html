<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hangman</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
          integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="javascripts/hangman.js"></script>
</head>
<body style="margin: 50px; align-items: center; align-content: center; justify-content: center; text-align: center">
<div aria-hidden="false" aria-labelledby="youLoseLabel" class="modal" id="youLose" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="youLoseLabel">YOU LOSE</h5>
                <button onclick="closeModal('youLose')" aria-label="Close" class="close" data-dismiss="modal"
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Thanks for playing, but you have lost. Want to play again?
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('youLose')" class="btn btn-secondary" data-dismiss="modal"
                        type="button">Nope!
                </button>
                <button onclick="startGame()" class="btn btn-primary" data-dismiss="modal" type="button">Let's Play
                    Again</button>

            </div>
        </div>
    </div>
</div>

<div aria-hidden="false" aria-labelledby="chooseCategoryLabel" class="modal" id="chooseCategory" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="chooseCategoryLabel">Please Choose a Category</h5>
                <button onclick="closeModal('chooseCategory')" aria-label="Close" class="close" data-dismiss="modal"
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Please choose a category before guessing a letter! We need to generate a word for you to guess!
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('chooseCategory')" class="btn btn-secondary" data-dismiss="modal"
                        type="button">Ok!
                    I am Sorry</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="false" aria-labelledby="youLoseLabel" class="modal" id="alreadyGuessed" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="alreadyGuessedLabel">YOU LOSE</h5>
                <button onclick="closeModal('alreadyGuessed')" aria-label="Close" class="close" data-dismiss="modal"
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                You have already guessed that letter. Please guess a different letter and try again.
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('alreadyGuessed')" class="btn btn-secondary" data-dismiss="modal"
                        type="button">Resign</button>
                <button onclick="startGame()" class="btn btn-primary" data-dismiss="modal"
                        type="button">Ok! I will try again
                </button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="false" aria-labelledby="playerWonLabel" class="modal" id="playerWon" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="playerWonLabel">YOU WIN</h5>
                <button onclick="closeModal('playerWon')" aria-label="Close" class="close" data-dismiss="modal"
                type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                You correctly guessed the word! Congratulations!
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('playerWon')" class="btn btn-secondary" data-dismiss="modal"
                        type="button">Quit while I am ahead</button>
                <button onclick="startGame()" class="btn btn-primary" data-dismiss="modal"
                        type="button">Play Again
                </button>
            </div>
        </div>
    </div>
</div>

<div class="alert alert-secondary">
    <h1 style="text-align: center">Hangman</h1>
    <hr>
    <p>Welcome to Hangman!</p>
    <p>The goal of the game is to guess the word I am thinking of. For each incorrect answer, the man is one limb
        closer to
        hanging. I know what you are thinking - Yes, we are pretty metal.</p>
    <p>To begin, set the number of characters in the word you wish to guess. Then select a category. Then enter your
    guess into the guess box!</p>
    <p>Words and letters are accepted. However, the entire word is considered, if your word guess is wrong, it only
        counts as 1 limb. You have 5 "misguesses" before you lose. You will lose on your 5th wrong guess.</p>
    <p>And just to make all this scarring "killing a man over a word game" stuff easier, I have made it so you can
        hit either the "Guess!" button or your enter key to submit your guess. I know, I am a generous guy. You're
        welcome.</p>
    <h3 style="text-align: center">Now let the guessing begin!</h3>
</div>

<div style="width: 100%">Maximum number of letters in word</div>
<div class="slidecontainer" style="display: flex; justify-content: center;">

    <div style="width: 50%;">
        <input class="form-range" id="wordLength" max="10" min="5" onclick="slider()" step="1" style="padding-left:
         50%"
               type="range">
        <svg height="14" width="100%" xmlns="http://www.w3.org/2000/svg">
            <text class="range__point" text-anchor="start" x="50%" y="14">5</text>
            <text class="range__point" text-anchor="middle" x="60%" y="14">6</text>
            <text class="range__point" text-anchor="middle" x="70%" y="14">7</text>
            <text class="range__point" text-anchor="middle" x="80%" y="14">8</text>
            <text class="range__point" text-anchor="middle" x="90%" y="14">9</text>
            <text class="range__point" text-anchor="end" x="100%" y="14">10</text>
        </svg>
    </div>

    <div id="rangeDisplay" style="width: 30%; float: left;"></div>
</div>

<br>
<h5>Categories:</h5>
<button class="btn btn-primary" id="catFood" onclick="selectOption('food')" type="button">Food</button>
<button class="btn btn-primary" id="catAnimals" onclick="selectOption('animals')" type="button">Animals</button>

<div style="padding-bottom: 50px"></div>


<div class="form-floating mb-3">

    <input class="form-control" id="playersGuess" type="text" placeholder="p"/>
    <label class="form-label" for="playersGuess">Guess a letter/word</label>
</div>

<div class="input-group-append">
    <button class="btn btn-outline-secondary"
            onclick="guessALetter(document.getElementById('playersGuess').value.toLowerCase())"
            type="button">Guess!
    </button>
</div>

<br>

<div class="alert alert-primary" id="" role="alert">
    Word: <p id="currentWordShown">Please select a category!</p>
</div>
<div>

</div>
<div class="alert alert-primary" id="guessedLetters">
    Guessed Letters
    <hr>
    <p id="guessedLettersDisplay"></p>
    <hr>
    Incorrect Guesses <br>
    <progress id="errorProgressBar" max="100" value="0">Error</progress>
</div>


<script>
    var words = {
        "categories":
            {
                "food":["apple", "banana", "coconut","bilberry", "pineapple", "grapefruit"],
                "animals":["zebra", "bobcat", "giraffe", "platypus", "alligator", "bloodhound"]
            }
    }

    document.getElementById('playersGuess').addEventListener('keyup', function (event) {
            if (event.code === 'Enter') {
                guessALetter(document.getElementById('playersGuess').value.toLowerCase());
            }
        });




    let category = "";
    let count = 4;
    var wordToGuess = "";
    let guessedLetters = [];
    let incorrectGuesses = 0;

    function slider() {
        count = document.getElementById("wordLength").value;
        document.getElementById("rangeDisplay").innerHTML = count;
    }

    function startGame() {
        document.getElementById("catFood").disabled = false;
        document.getElementById("catAnimals").disabled = false;
        document.getElementById('playersGuess').value = "";
        $("#playerWon").modal("hide");
        $("#youLose").modal("hide");
        $("#alreadyGuessed").modal("hide");
        $("#chooseCategory").modal("hide");
        replaceBlanks();
        document.getElementById("currentWordShown").innerHTML = "Please select a category!"
        document.getElementById("guessedLettersDisplay").innerHTML = "Please select a category!"
        category = "";
        count = 5;
        wordToGuess = "";
        guessedLetters = [];
        incorrectGuesses = 0;
    }

    function selectOption(option) {
        category = option;
        document.getElementById("catFood").disabled = true;
        document.getElementById("catAnimals").disabled = true;
        document.getElementById("currentWordShown").innerHTML = ""
        document.getElementById("guessedLettersDisplay").innerHTML = ""
        selectWord();
    }

    function guessALetter(currGuess) {
        if(wordToGuess === "") {
            $("#chooseCategory").modal("show");
            return;
        }

        if(/^[a-zA-Z]+$/.test(currGuess))
        if (!alreadyGuessed(currGuess)) {
            if (incorrectGuesses < 5) {
                if (guessedLetters.length === 0)
                    document.getElementById("guessedLettersDisplay").innerHTML = currGuess;
                else {
                    document.getElementById("guessedLettersDisplay").innerHTML =
                        document.getElementById("guessedLettersDisplay").innerHTML + ","
                        + currGuess;
                }
                if(currGuess.length === 1) {
                    guessedLetters.push(currGuess);
                    let pushed = 0;
                    for (let i = 0; i < wordToGuess.length; i++) {
                        if (wordToGuess[i] === currGuess) {
                            guessedLetters.push(i);
                            pushed++;
                        }
                    }

                    if (pushed === 0) {
                        incorrectGuesses++;
                        if (incorrectGuesses === 5) {
                            $("#youLose").modal("show");
                        }
                    }
                } else {
                    if(currGuess === wordToGuess){
                        $("#playerWon").modal("show");
                    } else {
                        incorrectGuesses++;
                        guessedLetters.push(currGuess);
                        if (incorrectGuesses === 5) {
                            $("#youLose").modal("show");
                        }
                    }
                }
                replaceBlanks();
            } else {
                $("#youLose").modal("show");
            }
        } else {
            $("#alreadyGuessed").modal("show");
        }

        document.getElementById('playersGuess').value = "";
    }

    function closeModal(modalName){
        console.log("Closing " + modalName);
        $("#" + modalName).modal("hide");
    }

    function alreadyGuessed(letter) {
        if (guessedLetters.includes(letter))
            return true;
        return false;
    }

    function replaceBlanks() {
        let displayNew = "";
        let guessedTheWord = true;
        for (let i = 0; i < wordToGuess.length; i++) {
            if (guessedLetters.includes(i)) {
                displayNew = displayNew.concat(wordToGuess[i]);
            } else {
                guessedTheWord = false;
                displayNew = displayNew.concat("_ ");
            }
        }

        document.getElementById("currentWordShown").innerText = displayNew;
        updateIncorrectAnswers();

        if (guessedTheWord) {
            $("#playerWon").modal("show");
        }
    }

    function updateIncorrectAnswers() {
        let newVal = (incorrectGuesses * (100 / 5))
        document.getElementById("errorProgressBar").value = newVal;
    }

    function selectWord(){
        let wordLength = document.getElementById("wordLength").value
        wordToGuess = words.categories[category][wordLength-5];
        replaceBlanks();
    }
</script>
</body>
</html>